-- MysticOS System Monitor

-- WIP --

local refreshTimer = os.startTimer(1)

local screenW, screenH = graphics.getSize()

local function getProcessList()
	local list = {}
	local l = os.processList()
	for i = 1, #l do
		list[i] = l[i].id.." "..l[i].name.." "..l[i].runTime
	end
	return list
end

local function getFsUsage()
	return "Disk Space: "..fs.getFreeSpace("/").." bytes"
end

-- GUI

local frame = gui.frame(1, 1, screenW, screenH)

local function exit()
	frame:close()
end

local exitButton = gui.button(screenW, 1, 1, 1, "x", exit)
exitButton:setBackgroundColor(colors.red)
frame:addChild(exitButton)

local fsLabel = gui.label(1, screenH, screenW, 1, getFsUsage())
frame:addChild(fsLabel)

local list = gui.list(1, 2, screenW, screenH - 2, getProcessList())
frame:addChild(list)

local function handleEvent(evt, ...)
	local args = {...}
	if evt == "timer" then
		if args[1] == refreshTimer then
			list:setList(getProcessList())
			refreshTimer = os.startTimer(1)
		end
	end
end

frame:run(handleEvent)